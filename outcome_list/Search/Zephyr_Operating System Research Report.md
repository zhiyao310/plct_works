# Zephyr 操作系统调研报告

目录

- [一、简介](#一、简介)
- [二、系统整体架构](#二、系统整体架构)
- [三、构建体系](#三、构建体系)
- [四、软件包管理](#四、软件包管理)
- [五、维护机制](#五、维护机制)
- [六、产业影响分析](#六、产业影响分析)
- [七、与同类 RTOS 对比](#七、与同类 RTOS 对比)

## 一、简介

Zephyr 是专为资源受限设备设计的开源实时操作系统（RTOS），其核心理念聚焦开源协同、轻量可裁剪、实时优先、跨架构兼容与长期迭代，并非单一内核，而是完整的 RTOS 解决方案，核心包括实时内核、硬件适配层、模块化组件、构建测试工具链及生态组件，可适配多场景需求。

Zephyr 定位为“资源受限设备的开源实时操作系统底座”，区别于传统 RTOS 与通用 Linux 发行版，核心应用于物联网、工业控制、车规电子、嵌入式、科研教育五大领域，是开源 RTOS 生态核心力量，推动实时操作系统标准化发展。

## 二、系统整体架构

Zephyr 采用清晰的分层架构，从上至下依次为 5 个层级，各层独立模块化设计，既保障了系统的灵活性，又实现了硬件与软件的解耦，确保高效、稳定运行：

- 用户应用层：包含用户自定义应用程序、第三方开源组件（如 TensorFlow Lite Micro），通过系统 API 调用底层功能，满足具体场景需求；

- 核心服务层：由各类独立模块组成，包括网络协议栈（lwIP、BLE 等）、安全框架、虚拟文件系统、电源管理等，可通过 Kconfig 按需裁剪；

- 内核层：系统核心，提供任务调度、内存管理、中断管理、进程间通信等基础功能，支持 SMP 多核调度，中断延迟低于 5us；

- 硬件适配层（HAL/DT）：包含设备树解析、统一驱动 API、硬件抽象层，负责将内核与具体硬件解耦，实现跨架构适配；

- 硬件层：目标硬件设备，包括 CPU（ARM、RISC-V 等）、外设（UART、SPI 等）、传感器等，Zephyr 官方支持 200+ 开发板。

## 三、构建体系

Zephyr的构建体系以“现代化、自动化、跨平台”为核心目标，基于CMake、Ninja构建工具，结合West命令行工具，实现从源码获取、配置、编译、链接到烧录、调试的全流程自动化，支持Windows、Linux、macOS三种主流开发环境，同时提供Twister自动化测试框架，确保构建产物的稳定性与可靠性。与传统RTOS采用的Makefile构建方式相比，Zephyr的构建体系更具灵活性与高效性，可大幅提升开发与测试效率。

### 3.1 构建核心工具

Zephyr的构建体系依赖一系列工具，各工具分工明确、协同工作，核心工具包括：

#### 3.1.1 West工具

West是Zephyr官方推出的命令行工具，被称为“Zephyr开发的瑞士军刀”，是构建体系的核心调度工具，负责工作区管理、源码管理、依赖包管理、构建调度、烧录调试等全流程操作，核心功能如下：

- 工作区初始化：通过west init命令初始化Zephyr开发工作区，默认拉取Zephyr源码仓库（https://github.com/zephyrproject-rtos/zephyr），同时支持通过-m参数手动指定源码仓库地址，通过--mr参数指定版本号（如west init -m https://github.com/zephyrproject-rtos/zephyr --mr v2.6.0）。
- 源码与依赖管理：通过west update命令拉取Zephyr依赖的所有模块（如HAL库、第三方组件、驱动SDK等），这些依赖模块单独管理，分布在不同的仓库中，west会自动将其下载到工作区指定目录，形成完整的源码环境；通过west list命令可查看当前工作区所有外部代码仓库的信息。
- 构建调度：通过west build命令触发CMake构建流程，支持指定开发板（-b参数）、应用程序路径、构建配置等，自动完成编译、链接，生成镜像文件。
- 烧录与调试：通过west flash命令将构建生成的镜像文件烧录到目标硬件设备，通过west debug命令启动调试模式，结合GDB等调试工具实现实时调试；同时支持west run命令，实现“构建-烧录-运行”一键完成。
- 扩展功能：支持自定义扩展指令，可集成第三方工具，满足个性化开发需求；同时支持工作区版本管理，便于多版本开发与切换。

West工具可通过pip命令快速安装（pip3 install --user -U west），适配Windows、Linux、macOS三种开发环境，安装便捷、使用简单。

#### 3.1.2 CMake与Ninja

CMake是跨平台的构建配置工具，负责解析Zephyr的构建配置文件（CMakeLists.txt），生成适配当前开发环境的构建脚本；Ninja是轻量级的构建执行工具，负责执行CMake生成的构建脚本，完成源码编译、链接等操作，其优势是构建速度快、资源占用低，可大幅提升构建效率。

Zephyr的构建体系中，CMake负责“配置”，Ninja负责“执行”，两者协同工作：开发者通过修改CMakeLists.txt文件配置构建参数（如启用/禁用组件、指定编译选项、链接库等），CMake解析该文件后生成Ninja构建脚本，Ninja执行脚本完成构建过程，生成最终的镜像文件（如zephyr.bin、zephyr.elf）。

#### 3.1.3 Kconfig配置系统

Kconfig是Zephyr的配置系统，源自Linux内核的Kconfig机制，负责实现组件的灵活裁剪与参数配置，核心功能如下：

- 组件裁剪：通过图形化界面（menuconfig）或配置文件（prj.conf），开发者可灵活选择启用或禁用Zephyr的内核组件、服务组件、驱动组件等，实现系统功能的定制化，降低资源占用。例如，物联网传感器节点场景可禁用文件系统、Wi-Fi等不必要的组件，仅保留核心的任务调度与BLE通信功能。
- 参数配置：可配置内核参数（如任务优先级范围、内存大小、调度策略等）、硬件参数（如引脚配置、外设参数等）、服务参数（如网络协议配置、安全参数等），无需修改源码即可实现系统参数的调整。
- 配置生效：Kconfig配置文件（prj.conf）会被CMake解析，生成对应的头文件（zephyr/autoconf.h），编译过程中自动引入该头文件，确保配置参数生效；同时支持配置校验，避免无效配置导致的构建失败。

#### 3.1.4 Twister自动化测试框架

Twister是Zephyr官方提供的自动化测试框架，集成在构建体系中，负责对构建产物进行自动化测试，确保系统功能的正确性与稳定性，核心功能如下：

- 测试用例管理：支持批量执行测试用例，可指定测试范围（如内核测试、驱动测试、网络测试等），支持测试用例的过滤与排序。
- 多平台测试：支持在多种硬件平台、QEMU仿真环境中执行测试用例，验证系统在不同环境下的兼容性与稳定性。
- 测试报告生成：测试完成后，自动生成详细的测试报告，包含测试用例执行结果、错误信息、性能数据等，便于开发者定位问题。
- CI/CD集成：支持与GitLab CI、GitHub Actions等持续集成/持续部署工具集成，实现“代码提交-构建-测试”全流程自动化，提升开发效率与代码质量。

### 3.2 构建流程

Zephyr 遵循“标准化、自动化、可复用”原则，依托 West、CMake 等核心工具，形成了完整的构建流程，适配嵌入式设备开发特点，具体步骤如下：

1. 需求分析与场景定位：明确目标设备的资源约束（内存、Flash）、功能需求（网络、安全等）、实时性要求，确定模块配置方向；

2. 模块选型与配置（Kconfig）：通过图形化或命令行工具，启用所需功能模块，关闭冗余模块，配置内核参数，生成配置文件；

3. 硬件适配（设备树配置）：基于官方模板修改设备树文件，描述目标硬件细节，完成硬件与软件的适配，无需修改内核代码；

4. 编译构建（West+CMake）：通过 West 拉取源码与依赖，CMake 生成编译脚本，交叉编译工具链完成编译、链接，生成二进制文件；

5. 自动化测试验证（Twister）：通过 Twister 框架执行测试用例，覆盖功能、实时性、稳定性测试，排查异常问题；

6. 固件生成与部署：测试通过后，生成目标设备支持的固件格式，集成安全特性，通过调试工具烧录部署。

### 3.3 构建特色

- 轻量可裁剪：通过 Kconfig 精细化裁剪，内核体积可从几 KB 灵活调整，适配超微型设备；

- 跨架构适配高效：仅需修改设备树，同一套代码即可适配多架构，移植效率比传统 RTOS 提升 80% 以上；

- 全流程自动化：整合工具链实现构建、测试、部署自动化，可集成到 DevOps 流水线，降低人工成本；

- 安全构建集成：将安全特性嵌入构建流程，从源头排查安全漏洞，保障固件安全；

- 厂商协同构建：主流芯片厂商参与构建，贡献设备树与驱动，快速扩展硬件支持范围。

## 四、维护机制

### 4.1 维护流程与策略

#### 1. 版本维护策略

遵循“稳定版+开发版+LTS 版”三版本并行策略，迭代周期标准化：

- 开发版（Main 分支）：用于开发新功能、适配新硬件，更新频率高，稳定性较差，仅推荐开发者使用；

- 稳定版（Stable）：每 6 个月发布一次（4 月、10 月），支持周期 1 年，仅发布 bug 修复与安全更新，不引入新功能；

- 长期支持版（LTS）：每 2.5-3 年发布一次，支持周期长达 5 年，重点修复严重安全漏洞与关键 bug，适配工业、车规等长期运行场景。

#### 2. 安全维护机制

- 漏洞监控：安全团队持续监控 CVE 数据库、社区反馈与厂商上报的漏洞，建立漏洞跟踪台账；

- 补丁开发：快速开发漏洞修复补丁，并反向移植到所有支持版本，确保全面覆盖；

- 安全更新发布：通过官方仓库发布安全更新，同步发布安全公告，明确漏洞风险与修复方法；

- 安全认证维护：推进安全认证（PSA、ISO 26262）适配，遵循 MISRA-C 标准，定期进行静态安全分析。

#### 3. 硬件适配维护策略

- 厂商协同适配：芯片厂商负责自身硬件的驱动与设备树开发，社区审核整合，快速扩展硬件支持范围；

- 模板化维护：官方提供开发板设备树模板，开发者可快速修改适配，降低移植成本；

- 兼容性测试：通过 Twister 框架对已适配硬件持续测试，排查兼容性问题，保障适配质量。

### 4.2 维护工具与平台

- GitHub：核心代码托管与协作平台，所有维护过程（代码提交、PR 审核、Issues 反馈）公开透明；

- West/CMake/Twister：维护过程中的核心工具，实现代码同步、补丁管理、自动化测试；

- Zephyr Docs：官方维护文档平台，同步更新维护规范、版本日志、开发指南；

- 邮件列表与社区论坛：维护团队与社区、用户的沟通平台，讨论维护策略与技术问题；

- CI/CD 流水线：整合 GitHub Actions、Jenkins 等，实现代码提交—测试—审核—合并全流程自动化。

### 4.3 维护特色

- 厂商协同维护：主流芯片厂商深度参与，提升工业级适配能力与维护专业性；

- 自动化程度高：工具链整合实现维护全流程自动化，提升维护效率，减少人工成本；

- 长期支持能力突出：5 年 LTS 支持周期，适配工业、车规等对稳定性要求极高的场景；

- 社区活跃度高：600+ 活跃贡献者，每月合并 200+ PR，bug 修复与功能迭代速度快。

## 五、产业影响分析

### 5.1 产业应用场景渗透

Zephyr凭借轻量可扩展、安全可靠的优势，已深度渗透物联网、工业控制、汽车电子、可穿戴设备、航空航天等领域，适配从小型传感器到复杂多核系统的全场景需求。其低资源占用特性降低物联网终端开发门槛，安全认证适配工业、车规级场景，低功耗优势支撑可穿戴、航空航天等严苛场景，推动各领域设备向智能化、小型化升级。

### 5.2 对开源RTOS生态的影响

作为Linux基金会托管的顶级开源项目，Zephyr以厂商中立、开源开放的特点，打破传统开源RTOS生态封闭格局，吸引主流半导体厂商参与，形成完整协同生态。其模块化架构、标准化配置与包管理机制，为开源RTOS领域提供技术参考，推动生态标准化、规范化发展，降低商业应用门槛，打破商业RTOS高端场景垄断。

### 5.3 对半导体产业的影响

Zephyr与半导体产业相互赋能，为芯片厂商提供统一硬件适配框架，降低芯片研发与推广成本，同时推动芯片厂商优化高性能、低功耗、高安全特性。对终端应用企业而言，其跨平台适配能力降低芯片选型与开发成本，提升产品研发效率，推动MCU、物联网芯片领域升级与市场多元化发展。

### 5.4 政策与市场层面影响

政策层面，Zephyr契合全球物联网、工业互联网等产业升级政策，可为我国国产化替代提供适配支持，降低对国外商业RTOS的依赖。市场层面，其崛起重构RTOS市场格局，形成“商业+开源”双轨发展模式，同时带动开发工具、技术服务等配套产业发展，完善嵌入式与物联网产业价值链。

## 六、与同类 RTOS 对比

| 特性       | Zephyr                          | FreeRTOS                       | RT-Thread                      | VxWorks                      |
| ---------- | ------------------------------- | ------------------------------ | ------------------------------ | ---------------------------- |
| 主导方     | Linux 基金会（开源+厂商协同）   | 亚马逊（商业导向+开源）        | 国内社区（开源+本土化适配）    | Wind River（商业闭源）       |
| 架构设计   | 模块化，Kconfig 可裁剪          | 单体架构，功能耦合度高         | 模块化，可裁剪                 | 宏内核，功能完善             |
| 实时性     | 极高（中断延迟<5us，支持 SMP）  | 高（仅支持抢占式调度）         | 高（支持多核调度）             | 极高（工业级标杆）           |
| 跨架构支持 | 20+ 架构，200+ 开发板（官方）   | 多架构，40+ 开发板（官方）     | 主流架构，本土化芯片适配好     | 多架构，工业/车规硬件适配强  |
| 社区活跃度 | 极高（600+ 贡献者，200+ PR/月） | 中等（100+ 贡献者，50+ PR/月） | 较高（本土化社区活跃）         | 低（商业闭源，社区有限）     |
| 典型场景   | IoT、工业控制、车规电子、可穿戴 | 消费电子、简单 IoT 设备        | 本土化 IoT、消费电子、工业控制 | 航空航天、工业控制、车规核心 |

**参考链接**：

> Zephyr 官方网站（[Zephyr项目](https://www.zephyrproject.org/)）
>
> Zephyr 官方介绍文档（[简介 — Zephyr 项目文档](https://docs.zephyrproject.org/latest/introduction/index.html)）
>
> Zephyr 硬件适配文档（[硬件支持 — Zephyr 项目文档](https://docs.zephyrproject.org/latest/hardware/index.html)）;
>
> Zephyr 官方架构文档（[Zephyr项目文档 — Zephyr项目文档](https://docs.zephyrproject.org/latest/)）
>
> Zephyr 硬件适配官方指南（[支持的板块和盾牌——Zephyr项目文档](https://docs.zephyrproject.org/latest/boards/#)）
>
> Zephyr 官方构建文档（[与Zephyr合作开发——Zephyr项目文档](https://docs.zephyrproject.org/latest/develop/)）
>
> Zephyr 安全维护文档（[GitHub - zephyrproject-rtos/zephyr：Zephyr 项目的主 Git 仓库。Zephyr 是一款新一代、可扩展、优化且安全的多硬件架构 RTOS。](https://github.com/zephyrproject-rtos/zephyr/tree/main)）